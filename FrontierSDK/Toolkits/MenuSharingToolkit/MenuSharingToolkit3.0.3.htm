<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta name=Title content="Menu Sharing Toolkit 3">
<meta name=Keywords content="">
<meta http-equiv=Content-Type content="text/html; charset=macintosh">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="MenuSharingToolkit3.0.3_files/filelist.xml">
<title>Menu Sharing Toolkit 3</title>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:HyphenationZone>0</w:HyphenationZone>
  <w:DoNotHyphenateCaps/>
  <w:DrawingGridHorizontalSpacing>6 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>6 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>
  <w:UseMarginsForDrawingGridOrigin/>
  <w:DoNotShadeFormData/>
  <w:Compatibility>
   <w:OrigWordTableRules/>
   <w:NoLeading/>
   <w:SpaceForUL/>
   <w:BalanceSingleByteDoubleByteWidth/>
   <w:DoNotLeaveBackslashAlone/>
   <w:ULTrailSpace/>
   <w:DoNotExpandShiftReturn/>
   <w:SpacingInWholePoints/>
   <w:ShowBreaksInFrames/>
   <w:SuppressTopSpacing/>
   <w:SuppressTopSpacingMac5/>
   <w:MWSmallCaps/>
   <w:UsePrinterMetrics/>
   <w:WW6BorderRules/>
   <w:FootnoteLayoutLikeWW8/>
   <w:ShapeLayoutLikeWW8/>
   <w:AlignTablesRowByRow/>
   <w:ForgetLastTabAlignment/>
   <w:DoNotUseHTMLParagraphAutoSpacing/>
   <w:LayoutRawTableWidth/>
   <w:LayoutTableRowsApart/>
   <w:UseWord97LineBreakingRules/>
  </w:Compatibility>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
@font-face
	{font-family:"Times New Roman";
	panose-1:0 2 2 6 3 5 4 5 2 3;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:50331648 0 0 0 1 0;}
@font-face
	{font-family:"New York";
	panose-1:0 2 2 5 2 6 3 5 6 2;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:50331648 0 0 0 1 0;}
@font-face
	{font-family:Monaco;
	panose-1:0 2 0 5 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:50331648 0 0 0 1 0;}
@font-face
	{font-family:Palatino;
	panose-1:0 2 0 5 0 0 0 0 0 0;
	mso-font-charset:0;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:50331648 0 0 0 1 0;}
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"New York";}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:12.0pt;
	font-family:Helvetica;
	mso-font-kerning:0pt;
	text-decoration:underline;
	text-underline:single;}
h2
	{mso-style-next:Normal;
	margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:12.0pt;
	font-family:Helvetica;}
h3
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.25in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:12.0pt;
	font-family:"New York";}
h4
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.25in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:4;
	font-size:12.0pt;
	font-family:"New York";
	text-decoration:underline;
	text-underline:single;
	font-weight:normal;}
h5
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:5;
	font-size:10.0pt;
	font-family:"New York";}
h6
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:6;
	font-size:10.0pt;
	font-family:"New York";
	text-decoration:underline;
	text-underline:single;
	font-weight:normal;}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:7;
	font-size:10.0pt;
	font-family:"New York";
	font-style:italic;}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{mso-style-next:Normal;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	mso-outline-level:8;
	font-size:10.0pt;
	font-family:"New York";
	font-style:italic;}
 /* Page Definitions */
@page
	{mso-page-border-surround-header:no;
	mso-page-border-surround-footer:no;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-page-numbers:1;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
</head>

<body bgcolor=white lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<h1 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in'><span style='font-size:18.0pt;text-decoration:none;text-underline:none'>Menu
Sharing Toolkit 3.0.3<o:p></o:p></span></h1>

<h2 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in'><span style='font-size:18.0pt'>UserLand Software, Inc.<o:p></o:p></span></h2>

<h3 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;font-weight:normal'>©
copyright 1992-1994, UserLand Software, Inc.<o:p></o:p></span></h3>

<h3 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;font-weight:normal'>UserLand
Software is located at 555 Bryant #237, Palo Alto, CA 94301. 415-326-7791,
415-326-7793 (fax). UserLand, Frontier and Frontier Runtime are trademarks of
UserLand Software, Inc. Other product names may be trademarks or registered
trademarks of their owners.<o:p></o:p></span></h3>

<h3 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;font-weight:normal'>Email:
userland.dts@applelink.apple.com. If you’re an AppleLink user, check out the
UserLand Discussion Board under the Third Parties icon. CompuServe users enter
GO USERLAND at any ! prompt. On America On-Line, enter the keyword USERLAND.<o:p></o:p></span></h3>

<h3 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;font-weight:normal'>Comments,
questions and suggestions are welcome!<o:p></o:p></span></h3>

<h2 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in'><span style='font-size:18.0pt'>Background<o:p></o:p></span></h2>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>What’s New?<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>If you are already familiar with menu sharing, skip
to “Menu Sharing Toolkit 3.0 Change Notes” which explains the improvements in
version 3.0 of the Menu Sharing Toolkit.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Frontier’s
Editable Menu Bar<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>One of Frontier’s many capabilities is that it gives
the script writer an easy way to edit the contents of its own menu bar. When
the user selects an item from the menu, Frontier runs the script that’s linked
into the menu item. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Menu sharing extends that capability so that script
writers can add commands to the menu bars of compatible applications. If you
follow the instructions in this file, your application will support menu
sharing and will work with all versions of Frontier.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Menus sharing adds a set of standard Macintosh menus
at the end of your application’s menu bar. Script writers can add commands to
these menus using Frontier. Any changes to your menus are automatically visible
as soon as the script writer switches back to your application.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>In order to be menu sharing-aware, an application
includes the Menu Sharing Toolkit and inserts calls to Toolkit routines in
several places: on initialization; in the main event loop; before processing a
menu selection and where the user presses cmd-period.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Menu sharing does not in any way alter the
performance of your menu commands, it just adds new commands to your menu bar.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Applications-as-Development-Platforms<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Menu sharing allows script writers to view your
application as a customizable development platform. They can add commands that
automate your application just as if it had an integrated scripting language.
Even if your application already has an integrated scripter, it makes sense to
support the menu sharing protocol because scripts can easily launch other
applications and integrate their capabilities with your program and the
Macintosh operating system.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Script users, usually less technical people than
script writers, will see simpler commands in these menus. Examples include:
prepare for a meeting, send a message to everyone working on a specific
project; write a press release; or hire a new employee. There are as many
potential custom scripts as there are Macintosh users. They will only be aware
that these commands were “put into” your application by a friend they work
with, or their organization’s network manager. The details of this technology
are completely open to the script writer, but neatly hidden from the end-user.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>By opening your product to menu sharing you offer
more technical users an easy way to simplify your product for less technical
users. This means your technology is more useful to a much larger number of
people, and can only contribute to making your product more competitive and
more profitable.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>No Royalty or
License Fee<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>There is no royalty or license fee for use of the
Menu Sharing Toolkit. It’s provided in source form so that developers know
exactly what the Toolkit is doing on their behalf, and so it can easily be
adapted to different development environments. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>You may include this code in any Macintosh
application, but you must maintain our copyright notice at the head of each
UserLand-supplied source file.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Menu Sharing is
Open<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We’re publishing source code for the client side of
the menu sharing protocol, and plan to support menu sharing in all future
versions of UserLand Frontier and all other software products developed by or
published by UserLand Software.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We believe menu sharing should be an open
specification, with freely distributed source code. Everyone wins if it’s
widely supported on both sides of the equation, by clients (the vast majority
of “sharing-aware” programs) and by servers (Frontier, and competitive
products).<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Icing on the Cake<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>It makes little or no sense to add menu sharing if
your application is only minimally Apple Event-aware. Scripts launched from
your menu bar must be able to call back into your program to open or close a
window, get a value, add a record, dial the phone -- basically to do the types
of things your program was designed to do.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Menu sharing, therefore, is like icing on a cake.
Once you’ve added a reasonably complete set of scriptable IAC messages, the
next step is to open up your menu bar to allow script writers to insert new
commands that are implemented in scripts. <o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Who supports menu
sharing?<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Examples of applications that support menu sharing:
Quark XPress 3.2, Think C and Symantec C++ 6.0, Aladdin Systems StuffIt 3.0 and
SITcomm 1.0, Apple Computer’s PhotoFlash. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Thru the FinderMenu extension, shipped with Frontier,
the System 7 Finder supports menu sharing.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Many more menu sharing-compatible applications are in
development and will be released in the coming months.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>If an application already supports Apple Events, it
should also support menu sharing. It’s a much smaller investment in time than
Apple Event support, and it delivers an important real benefit to script
writers and their users.<o:p></o:p></span></h4>

<h2 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in;page-break-before:always'><span style='font-size:18.0pt'>Cookbook<o:p></o:p></span></h2>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Introduction<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>In this section we’ll step through the source code
for “MenuSharer,” a very minimal Macintosh program, whose main reason for
existing is this tutorial. It pays to browse through the MenuSharer source code
before installing menu sharing in your program. MenuSharer is written using
Think C 6.0. To view the source code, open menusharer.π with Think C.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The Toolkit is implemented in menusharing.c. Its
header file is menusharing.h. To see how these routines are called, page
through main.c. You’ll see calls to Toolkit routines in five places:<o:p></o:p></span></h4>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt;text-indent:-15.0pt'><span style='font-size:12.0pt;
font-family:Palatino;font-weight:normal'>1.<span style='mso-tab-count:1'>&nbsp; </span>In
handlemenu -- we call SharedMenuHit to run scripts selected from a shared menu.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt;text-indent:-15.0pt'><span style='font-size:12.0pt;
font-family:Palatino;font-weight:normal'>2.<span style='mso-tab-count:1'>&nbsp; </span>In
handlekeystroke -- we call SharedScriptRunning and CancelSharedScript if the
user had pressed cmd-period to cancel a running script.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt;text-indent:-15.0pt'><span style='font-size:12.0pt;
font-family:Palatino;font-weight:normal'>3.<span style='mso-tab-count:1'>&nbsp; </span>In
handleevent -- we call CheckSharedMenus to reload the shared menus if they have
been changed by a script writer.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt;text-indent:-15.0pt'><span style='font-size:12.0pt;
font-family:Palatino;font-weight:normal'>4.<span style='mso-tab-count:1'>&nbsp; </span>In
main -- we call InitSharedMenus to set up globals and install handlers for
messages that may be sent by the menu server.<o:p></o:p></span></h5>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Following is a step by step “cookbook” for adding
menu sharing to any Macintosh application. <o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt;page-break-before:always'><span style='font-family:
Palatino'>Step #1 -- Initialize the Toolkit<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>After initializing the Macintosh using InitGraf,
InitFonts, etc., call the Toolkit InitSharedMenus routine:<o:p></o:p></span></h4>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:12.0pt;font-family:Palatino'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>if
(!InitSharedMenus (&amp;errordialog, &amp;eventfilter)) <o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>goto error;<o:p></o:p></span></h6>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>InitSharedMenus initializes menu sharing globals, and
installs Apple Event handlers for the two messages it must be prepared to
receive from the server. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>It returns false if the initialization failed for
some reason. Your application can continue, or as MenuSharer does, simply
display an alert and exit to the operating system.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>InitSharedMenus takes a two parameters: the address
of a routine that reports an error in a modal dialog and the address of a
routine that handles events. MenuSharer provides a two simple routines:<o:p></o:p></span></h4>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:12.0pt;font-family:Palatino'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>static
pascal void errordialog (Str255 s) {<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>ParamText (s, &quot;\p&quot;, &quot;\p&quot;,
&quot;\p&quot;); <o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>Alert (263, nil);<o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>} /*errordialog*/<o:p></o:p></span></h6>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>static
pascal void eventfilter (EventRecord *ev) {<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>handleevent (ev);<o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>} /*eventfilter*/<o:p></o:p></span></h6>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The error dialog routine is called when a script
terminates in an error. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>While a shared script is running, Frontier calls back
to the event filter routine when an update, activate, OS or null event is
available. This allows you to keep your windows pretty, and most important,
makes it possible for the user to bring another application to the front while
a script is running.<o:p></o:p></span></h4>

<span style='font-size:12.0pt;font-family:Palatino;mso-ansi-language:EN-US'><b><br
clear=ALL style='page-break-before:always'>
</b></span>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Step #2 -- Add a
Call in Your Main Event Loop<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>In your main event loop, when you receive a null
event and are not in the background, insert a call to CheckSharedMenus. You can
keep track of whether or not you are in the background by setting a global flag
each time you receive a suspend/resume event. It’s important that you only call
CheckSharedMenus when you’re active to ensure that the menubar can be updated
properly. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>If your menus need updating, CheckSharedMenus
automatically disposes your out-of-date shared menus, and conducts a short
conversation with the menu sharing server to get your updated menus.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>CheckSharedMenus takes one parameter -- the resource
id for the first shared menu. If CheckSharedMenus loads new menus, they are
assigned resource ids starting with this number. It must be less than 255 to
allow for hiearchic menus, and must be small enough so that no menu has an id
of greater than 255. If there are n menus, and the parameter to
CheckSharedMenus is x, then the menu ids will range from x to x + n - 1. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>MenuSharer calls CheckSharedMenus in its handleevent
routine in main.c.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt;page-break-before:always'><span style='font-family:
Palatino'>Step #3 -- Add a Call in Your Menu Handler<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>In your menu handling routine, insert a call to
SharedMenuHit:<o:p></o:p></span></h4>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:12.0pt;font-family:Palatino'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>if
(SharedMenuHit (idmenu, iditem)) /*it was a shared menu item*/<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>goto exit;<o:p></o:p></span></h6>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>SharedMenuHit checks to see if the indicated menu is
a shared menu. If it returns false, the menu is </span><span style='font-family:
Palatino'>not</span><span style='font-family:Palatino;text-decoration:none;
text-underline:none'> a shared menu, and you should process the command the way
you normally would. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>If it is a shared menu, the toolkit sends a message
instructing the server to run the script. If the server is Frontier 1.0 or 2.0,
this call returns before the script runs. The shared menus are disabled. They
will be re-enabled when the script completes. Your program should immediately
return to its main event loop. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>If the server supports the “component menu sharing”
protocol, as Frontier 3.0 does, SharedMenuHit doesn’t return until the script
has completed execution. Your program doesn’t have to do anything special here.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>MenuSharer calls SharedMenuHit in its handlemenu
routine in main.c.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt;page-break-before:always'><span style='font-family:
Palatino'>Step #4 -- Add code to Your Keystroke Handler<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Now that we’ve given the user a way to launch a
script from your application’s menu bar, we have to provide a way to terminate
or cancel a script. Following the standard Macintosh user interface
conventions, this should be accomplished by pressing cmd-period while a script
is running.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Use SharedScriptRunning to determine if a script is
currently running. If it returns true, and the user has pressed cmd-period,
call CancelSharedScript to terminate the script.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Here’s the MenuSharer code, in main.c, that
implements script termination:<o:p></o:p></span></h4>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:12.0pt;font-family:Palatino'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>static
void handlekeystroke (EventRecord *ev) {<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>register char ch = (*ev).message &amp; charCodeMask;<o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>if (SharedScriptRunning ()) /*cmd-period terminates the
script*/<o:p></o:p></span></h6>

<p class=MsoHeading7 style='margin-top:2.15pt;margin-right:0in;margin-bottom:
2.15pt;margin-left:.6in'><span style='font-size:9.0pt;font-family:Monaco;
font-style:normal'>if (((*ev).modifiers &amp; cmdKey) &amp;&amp; (ch == '.')) {
<o:p></o:p></span></p>

<p class=MsoHeading8 style='margin-top:2.15pt;margin-right:0in;margin-bottom:
2.15pt;margin-left:.8in'><span style='font-size:9.0pt;font-family:Monaco;
font-style:normal'>CancelSharedScript (); /*cancel the shared menu script*/<o:p></o:p></span></p>

<p class=MsoHeading8 style='margin-top:2.15pt;margin-right:0in;margin-bottom:
2.15pt;margin-left:.8in'><span style='font-size:9.0pt;font-family:Monaco;
font-style:normal'>return;<o:p></o:p></span></p>

<p class=MsoHeading8 style='margin-top:2.15pt;margin-right:0in;margin-bottom:
2.15pt;margin-left:.8in'><span style='font-size:9.0pt;font-family:Monaco;
font-style:normal'>}<o:p></o:p></span></p>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>handlemenu (MenuKey (ch)); /*process the normal way*/<o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>} /*handlekeystroke*/<o:p></o:p></span></h6>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>[Note: This is example code. If you’re producing an
international product, you may use conventions other than cmd-period for
cancelling operations, and you should integrate this functionality with your
“cancel-operation-from-keyboard” code.]<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Step #5 --
Include &quot;menusharing.h&quot;<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Add a #include at the top of every file that calls
Menu Sharing Toolkit routines:<o:p></o:p></span></h4>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>#include
&lt;menusharing.h&gt;<o:p></o:p></span></h5>

<h2 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in;page-break-before:always'><span style='font-size:18.0pt'>Reference
Information<o:p></o:p></span></h2>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Introduction<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The Menu Sharing Toolkit is implemented in a single C
source file, menusharing.c. To use the Toolkit, include the menusharing.h
header file at the beginning of every source file that calls a Toolkit routine
or references a menu sharing global.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>There are five menu sharing routines that your
program is likely to call. Those routines are documented here. You can browse
the source code to see how these routines are implemented. You may need or want
to build other routines out of menusharing.c routines if you want shared menus
to appear as popup menus, or if you’re implementing shared menus in a Control
Panel, XCMD or Finder extension.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>In this section we try to avoid referring to Frontier
by name, rather we talk about the<span style="mso-spacerun: yes">&nbsp;
</span>“menu sharing server” or “menu server” application. As we mentioned
earlier, the menu sharing protocol is an open protocol, so it’s possible to
imagine other software playing the role of menu server.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Much of the information presented here is provided in
more detail in the Cookbook Section, above. This reference section is provided
primarily as a summary of the information presented in that section.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt;page-break-before:always'><span style='font-family:
Palatino'>Menu Sharing Globals<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>All the globals needed by the Menu Sharing Toolkit
are stored in a single C structure named MSglobals. Toolkit routines are
provided to initialize and operate on the fields of this structure, but we
provide the details and document it so you can monitor the performance of the
Toolkit using a source-level debugger.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Here’s what the declaration of MSglobals looks like:<o:p></o:p></span></h4>

<h4 style='margin-top:12.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:10.0pt;font-family:Courier;
text-decoration:none;text-underline:none'>typedef struct tyMSglobals { <o:p></o:p></span></h4>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>OSType
serverid; <o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>OSType
clientid; <o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>hdlmenuarray
hsharedmenus; <o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>Boolean
fldirtysharedmenus; <o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>Boolean
flscriptcancelled; <o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>Boolean
flscriptrunning; <o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>Boolean
flinitialized;<o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>long
idscript;<o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>ComponentInstance
menuserver;<o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>tyMSerrordialog
scripterrorcallback;<o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>tyMSeventfilter
eventfiltercallback;<o:p></o:p></span></h5>

<h5 style='margin-top:4.75pt;margin-right:0in;margin-bottom:0in;margin-left:
.6in;margin-bottom:.0001pt'><span style='font-family:Courier;font-weight:normal'>}
tyMSglobals;<o:p></o:p></span></h5>

<h4 style='margin-top:12.0pt;margin-right:0in;margin-bottom:12.0pt;margin-left:
.3in'><span style='font-size:10.0pt;font-family:Courier;text-decoration:none;
text-underline:none'>extern tyMSglobals MSglobals; <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.serverid</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'> is the
4-character identifier of the menu sharing server. It’s initialized by
InitSharedMenus to 'LAND' -- the 4-character creator id of UserLand Frontier. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.clientid</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'> is the
4-character identifier of your program. It’s set automatically by
InitSharedMenus using the Macintosh Process Manager (see IM-VI, Chapter 29).
This information is passed to menu server in an IAC message to determine the
set of shared menus being requested.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.hsharedmenus</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'> is the
data structure that holds the shared menus. It’s set to nil by InitSharedMenus.
See the declaration of hdlmenuarray in menusharing.h for further information.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.fldirtysharedmenus</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'><span
style="mso-spacerun: yes">&nbsp; </span>is a boolean. If true, the shared menus
are re-loaded the next time your application becomes the frontmost process.
It’s set true by InitSharedMenus to force an update the first time thru the
main event loop, and when the 'updm' IAC message is received from the menu
sharing server when the script writer makes an editing change to your shared
menu.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.flscriptcancelled</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'><span
style="mso-spacerun: yes">&nbsp; </span>is a boolean. If true, the currently
running script has been terminated by a call to CancelSharedScript, probably in
response to the user pressing cmd-period.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.flscriptrunning</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'><span
style="mso-spacerun: yes">&nbsp; </span>is a boolean. If true, a script is
running and the shared menus are disabled. It’s set true by SharedMenuHit and
cleared when the menu server sends a 'done' IAC message.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.flinitialized</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'><span
style="mso-spacerun: yes">&nbsp; </span>is a boolean. If true, InitSharedMenus
worked, if false it failed. Some toolkit routines return immediately if this
boolean is false.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.idscript</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'> is the
menu sharing server’s identifier for the currently running script. When the
Toolkit sends a message to the server of the script it identifies the script by
passing this value to the server.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.menuserver</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'> is the
Component Manager identifier for the connection between your application and
the menu sharing server. If the toolkit is using an Apple Event-based protocol
to communicate with the server, this field will be 0.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.scripterrorcallback</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'> is the
address of a routine that displays error messages. See “Menu Sharing Toolkit
3.0 Change Notes,” below, for details.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'><b>MSglobals.eventfiltercallback</b></span><span
style='font-family:Palatino;text-decoration:none;text-underline:none'> is the
address of a routine that handles events while scripts are running. See “Menu
Sharing Toolkit 3.0 Change Notes,” below, for details.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt;page-break-before:always'><span style='font-family:
Palatino'>Menu Sharing Routines<o:p></o:p></span></h3>

<h4 style='margin-top:8.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Monaco;text-decoration:
none;text-underline:none'>Boolean InitSharedMenus (tyMSerrordialog,
tyMSeventfilter);<o:p></o:p></span></h4>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Initializes the Menu Sharing Toolkit.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>It takes two parameters: the first is the address of a
routine that displays a Str255 in a dialog and waits for the user to click on
OK. tyMSerrordialog is defined as follows:<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.5in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>typedef pascal void (*tyMSerrordialog) (Str255);<o:p></o:p></span></h6>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>The second parameter is the address of a routine that
handles incoming update, activate, OS and null events. The server calls this
routine while it is running a shared script. tyMSeventfilter is defined as:<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.5in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>typedef pascal void (*tyMSeventfilter) (EventRecord *);<o:p></o:p></span></h6>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>InitSharedMenus establishes initial values for the fields
of MSglobals and installs two Apple Event message handlers -- one to catch the
“menu needs update” message, and another to handle the “script has completed”
message.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Returns true if the program is running on a version of the
Macintosh OS that supports Apple Events and if it was able to install handlers
for the two Apple Events, false otherwise. <o:p></o:p></span></h5>

<h4 style='margin-top:8.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Monaco;text-decoration:
none;text-underline:none'>Boolean CheckSharedMenus (short);<o:p></o:p></span></h4>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Call CheckSharedMenus from your main event loop when you
receive a null event and are not suspended via suspend/resume events. If the
shared menus need updating, the Toolkit sends an Apple Event message to the
server asking for your shared menus.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>The MenuHandles are assigned resource ids starting with the
id indicated by the single parameter. This number must be less than 255 to
allow for hierarchic menus, and must be small enough so that no menu has an id
of greater than 255.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Returns false if there was an error loading the shared
menus.<o:p></o:p></span></h5>

<h4 style='margin-top:8.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Monaco;text-decoration:
none;text-underline:none'>Boolean SharedMenuHit (short, short);<o:p></o:p></span></h4>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Call this routine when you’ve received a menu selection.
The first parameter is the id of the selected menu, the second parameter is the
id of the selected menu item.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>SharedMenuHit returns false if the menu isn’t a shared
menu. Your program should process the menu selection as it normally would.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>If it is a shared menu, SharedMenuHit sends an Apple Event
message to the menu sharing server, requesting that the script linked into that
menu item be run. Shared menus are disabled while the script is running.<o:p></o:p></span></h5>

<h4 style='margin-top:8.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Monaco;text-decoration:
none;text-underline:none'>Boolean SharedScriptRunning (void);<o:p></o:p></span></h4>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Returns true if a shared script is currently running, false
otherwise.<o:p></o:p></span></h5>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Use this routine to determine if a cmd-period should be
applied to terminating the current script using CancelSharedScript.<o:p></o:p></span></h5>

<h4 style='margin-top:8.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Monaco;text-decoration:
none;text-underline:none'>Boolean CancelSharedScript (void);<o:p></o:p></span></h4>

<h5 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt'><span style='font-size:12.0pt;font-family:Palatino;
font-weight:normal'>Call CancelSharedScript when the user presses cmd-period or
otherwise indicates that he or she wants the currently running script to be
terminated.<o:p></o:p></span></h5>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Messages that the
server sends<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The server sends two Apple Event messages as its part
of the menu sharing protocol. Both messages are handled automatically by Apple
Event handlers installed by InitSharedMenus. The class for both events is the
same as the 4-character creator identifier of your application.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>1. When your menu has been edited and requires
updating, the menu server sends an 'updm' message. The handler for this message
sets an MSglobals flag true. When your program becomes the frontmost
application, CheckSharedMenus sends a series of Apple Event messages to the
server requesting the new menus.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>2. When a shared script has completed, the server
sends a 'done' message. The handler for this message simply records the fact in
MSglobals and re-enables the shared menus.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Where your shared
menu lives<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Suppose your application’s creator id is 'WXYZ'. If
your application has a shared menu, it’s stored in Frontier’s object database
at system.menubars.WXYZ. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Since MenuSharer’s id is 'MENS', its menus are
located at system.menubars.MENS. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>If you implement menu sharing, you should also
develop a sample shared menu for distribution with your product as part of your
Frontier install file. See the “Frontier Install File Creator” sub-folder of
the Extras folder for details on creating an install file for your application.<o:p></o:p></span></h4>

<h2 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in;page-break-before:always'><span style='font-size:18.0pt'>Menu Sharing
Toolkit 3.0.3 -- 7/27/94 dmb<o:p></o:p></span></h2>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Universal
Headers, PowerPC compatibility<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The Menu Sharing Toolkit can now be built using Apple’s
Universal Headers under Symantec C/C++ 7.0 or Metrowerks C/C++ 1.0 68K or PPC.
Native or “fat binary” applications can be generated in the Code Warrior
environment. ANSI-conformant function prototypes are used thoughout the code,
so strict error checking can be enforced for Menu Sharing Toolkit projects.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>MenuSharingLib<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Instead of compiling the MSTK source into your native
application, you can link to MenuSharingLib, a PowerPC shared library. This
keeps the menusharing code separate from your application’s code, and allows it
to be revised independently. Note that you will need to have the library
installed in your user’s systems for your application to launch, unless you do
a “weak” link and check for the Toolkit’s presence at run time. (See you the
CodeWarrior documentation for details.)<o:p></o:p></span></h4>

<h2 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in;page-break-before:always'><span style='font-size:18.0pt'>Menu Sharing
Toolkit 3.0<o:p></o:p></span></h2>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Component menu
sharing<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Frontier 3.0 implements a more efficient menu sharing
protocol using the System 7.1 Component Manager. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The Menu Sharing Toolkit has been updated to use the
component protocol if it is available. Otherwise, it is prepared to use the
Frontier 2.0-compatible protocol, or even the Frontier 1.0 protocol.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>In order for component menu sharing to be the
protocol it uses, the Macintosh Component Manager must be present, and the
toolkit must be able to create an instance of a menu sharing server component
(type 'SHMN'). <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>When the component connection is used, scripts that
call back to your program run much faster because they are running within the
same process as your program. You can see how dramatic the results are by
running some of the scripts in MenuSharer’s shared menus.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Additionally, dialogs displayed by scripts now show
up without a layer switch. This makes the whole effect much better for script
writers. The illusion that it’s all happening inside your program is more solid
when dialogs show up without a layer switch.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Another advantage of using the Component Manager is
that, with this release, it is now possible for another program or code
resource to play the role of menu sharing server. Support for Frontier is only
hard-coded for earlier menu sharing protocols. <o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Frontier 3.0
supports all earlier protocols<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>If you support Menu Sharing 2.0 in a shipping
application, </span><span style='font-family:Palatino'>Frontier 3.0 is
compatible with it</span><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The net effect of installing Menu Sharing 3.0 is a
substantial increase in performance for script writers and users on systems
that have the Macintosh Component Manager installed.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>How to Upgrade<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt;text-indent:-15.0pt'><span style='font-family:Palatino;
text-decoration:none;text-underline:none'>1.<span style='mso-tab-count:1'>&nbsp; </span>Replace
the old versions of menusharing.c and menusharing.h with the new versions in
this package.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
.3in;margin-bottom:.0001pt;text-indent:-15.0pt'><span style='font-family:Palatino;
text-decoration:none;text-underline:none'>2.<span style='mso-tab-count:1'>&nbsp; </span>Recompile
your program. The compiler will catch two changes in the menu sharing API. The
next two sections detail the changes.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Two parameters
for InitSharedMenus<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>InitSharedMenus now takes two parameters: the address
of a callback routine that displays an error dialog and one that handles
events.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Check out the MenuSharer program for an example:<o:p></o:p></span></h4>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:12.0pt;font-family:Palatino'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>static
pascal void errordialog (Str255 s) {<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>ParamText (s, &quot;\p&quot;, &quot;\p&quot;,
&quot;\p&quot;); <o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>Alert (263, nil);<o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>} /*errordialog*/<o:p></o:p></span></h6>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>static
pascal void eventfilter (EventRecord *ev) {<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>handleevent (ev);<o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>} /*eventfilter*/<o:p></o:p></span></h6>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h5>

<h5 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.2in'><span style='font-size:9.0pt;font-family:Monaco;font-weight:normal'>if
(!InitSharedMenus (&amp;errordialog, &amp;eventfilter))<o:p></o:p></span></h5>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'>goto error;<o:p></o:p></span></h6>

<h6 style='margin-top:2.15pt;margin-right:0in;margin-bottom:2.15pt;margin-left:
.4in'><span style='font-size:9.0pt;font-family:Monaco;text-decoration:none;
text-underline:none'><![if !supportEmptyParas]>&nbsp;<![endif]><o:p></o:p></span></h6>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>The error dialog routine is called when a script
terminates in an error. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>While a shared script is running, Frontier calls back
to the event filter routine when an update, activate, OS or null event is
available. This allows the client to keep its windows pretty, and most
important, makes it possible for the user to bring another application to the
front while a script is running.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>There’s a new command to MenuSharer’s “Hairy” menu,
called Divide By Zero. When you choose it, MenuSharer’s errordialog routine is
called. To test the event filter routine, set a breakpoint on the handleevent
call and choose any command from MenuSharer’s shared menus.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>See the “Cookbook” and “Reference Information”
sections, above for more info.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>MSglobals.scriptcompletedcallback
is gone<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>In earlier versions of the Menu Sharing Toolkit, this
undocumented callback routine played a role very similar to the error dialog
described above -- it was used to report errors in scripts.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>You should delete all references to
MSglobals.scriptcompletedcallback in your program, if you have any.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>SharedScriptCancelled
calls can be deleted<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We recommend that you delete all calls to
SharedScriptCancelled.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>These calls are not needed for versions of Frontier
after version 2.0, which was shipped over a year ago, and was a free upgrade
for the entire installed base.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We’ve deleted the documentation for
CancelSharedScript. It is no longer mentioned in the Cookbook section of the
menu sharing documentation.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Does not require
IAC Tools<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Previous versions of the Menu Sharing Toolkit used
the IAC Tools library to manage Apple Events. In version 3.0, we removed this
dependency. All the Apple Event code needed to support menu sharing is included
in the menusharing.c file. <o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>New fields in
MSglobals<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>There are are four new fields in the MSglobals
structure: menuserver,<span style="mso-spacerun: yes">&nbsp;
</span>scripterrorcallback, eventfiltercallback, and flinitialized. Like other
fields of MSglobals, these should be viewed as read-only. They are provided
primarily to support debugging.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>See “Reference Information” above for details on
these new fields.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We deleted the scriptcompletedcallback field of
MSglobals, since its function has been completely been replaced by
scripterrorcallback.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Builds in MPW<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>menusharing.c compiles without error or warning in
MPW C. Thanks to Leonard Rosenthol of Aladdin Systems for his help here.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Added #ifdefs<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>There are two #defines at the head of menusharing.,c
that allow you to turn off support for component menu sharing, or to turn off
support for Frontier 2.0 and 1.0.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We strongly recommend that you leave both #defines as
they are. But if there’s a need to turn one or the other off, and you know what
you’re doing, now it is possible.<o:p></o:p></span></h4>

<h2 style='margin-top:.25in;margin-right:0in;margin-bottom:9.0pt;margin-left:
0in;page-break-before:always'><span style='font-size:18.0pt'>Menu Sharing
Toolkit 2.0<o:p></o:p></span></h2>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>No impact on the
API<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We’ve made some major improvements in the efficiency
of the Toolkit in version 2.0. However, these changes have no impact on the
API, if you built on the 1.0 API you can simply replace the 1.0 library with
the 2.0 library and rebuild your application.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Further, if you installed Menu Sharing 1.0 in a
shipping application, </span><span style='font-family:Palatino'>Frontier 2.0 is
compatible with it</span><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>. The net effect of installing Menu Sharing 2.0 is an
increase in performance for script writers and users.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Where to call
CheckSharedMenus<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We’ve changed our recommendation on where to call
CheckSharedMenus in your program. In SDK 1.0 we recommended calling it in your
main event loop, at the same time you adjust your cursor and enable/disable
menu items. In 2.0, we go more conservative, and ask that you only call
CheckSharedMenus when you are not suspended and you receive a null event
(WaitNextEvent returns false). See the MenuSharer program for an example.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>It’s much faster<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We use the new support for system event handlers in
the IAC Tools library. If the server app has installed a set of system event
handlers to implement the server side of the menu sharing protocol, we use them
instead of sending Apple Events thru the operating system. The net result is virtually
instantaneous loading and updating of shared menus. This performance increase
is completely transparent to your program.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Compatibility<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>Frontier Runtime 1.0 supports the faster form of menu
sharing. Frontier 1.0 does not. A version of Frontier supporting the faster
protocol is in development. This Toolkit is fully compatible with present and
future versions of Frontier. <o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>UserLand will continue to support the 1.0 form of
menu sharing in all future versions of Frontier and other products. If you’ve shipped
a product with the 1.0 Menu Sharing Toolkit, UserLand will remain compatible
with it.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>Sends 'kill'
message when script is cancelled<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We've enhanced the protocol so that someday it may
not be necessary to call SharedScriptCancelled in each of your Apple Event
handlers. Instead of just setting a flag, CancelSharedScript now sends a 'kill'
message to the menu sharing server (Frontier) to kill the script that was
launched by calling RunSharedMenuItem, if the server has such a handler
installed. If not (Frontier 1.0 does not), it depends on the
SharedScriptCancelled method.<o:p></o:p></span></h4>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>However, this protocol is not understood by Frontier
1.0, so we had to leave in the old method. The Menu Sharing Toolkit knows which
version of Frontier it's talking to. If it's 1.0, it simply sets the flag and
returns. If it's 2.0 or greater, it sends the 'kill' message. The net: you have
to leave in your CancelSharedScript calls in your AE handlers for now. Once we
have most of the 1.0 base upgraded to 2.0, it will be possible to remove those
calls.<o:p></o:p></span></h4>

<h3 style='margin-top:14.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino'>In
RunSharedMenuItem<o:p></o:p></span></h3>

<h4 style='margin-top:7.0pt;margin-right:0in;margin-bottom:0in;margin-left:
0in;margin-bottom:.0001pt'><span style='font-family:Palatino;text-decoration:
none;text-underline:none'>We check to see if the server is still running, if
not, we remove the shared menus and return false.<o:p></o:p></span></h4>

</div>

</body>

</html>
